{% extends 'base.html' %}

{% block content %}
<h1>Verkaufsliste</h1>
<style>
  table {
    border-collapse: collapse;
    width: 100%;
  }

  th, td {
    padding: 8px;
    text-align: left;
    border-bottom: 1px solid #ddd;
  }

  tr:nth-child(even) {
    background-color: #f2f2f2;
  }
</style>

<table>
  <thead>
    <tr>
      <th>Gerät</th>
      <th>Preis</th>
      <th>Verkaufsdatum</th>
      <th>Zahlungsart</th>
      <th>Kunde</th>
      <th>Rechnungsnummer</th>
      <th>Verkäufer</th>
      <th>Bezahlt</th>
      <th>Zahlungsdatum</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    {% for verkauf in verkauf_list|dictsortreversed:'verkaufsdatum' %}
    <tr>
      <form action="{% url 'verkauf_liste' %}" method="post">
        {% csrf_token %}
        <td>
          {% if verkauf.waschmaschine %}
            {{ verkauf.type_of}}
          {% elif verkauf.kuhlschrank %}
            {{ verkauf.type_of}}
          {% elif verkauf.spuelmaschine %}
            {{ verkauf.type_of}}
          {% endif %}
        </td>
        <td>{{ verkauf.preis }}</td>
        <td>{{ verkauf.verkaufsdatum }}</td>
        <td>{{ verkauf.zahlungsart }}</td>
        <td>{{ verkauf.kunde_name }}</td>
        <td>{{ verkauf.rechnungs_nr }}</td>
        <td>{{ verkauf.verkäufer }}</td>
        <td>
          <select name="bezahlt" onchange="confirmBezahltChange(this)">
            <option value="--">--</option>
            <option value="Ja" {% if verkauf.bezahlt == 'Ja' %}selected{% endif %}>Ja</option>
            <option value="Nein" {% if verkauf.bezahlt == 'Nein' %}selected{% endif %}>Nein</option>
          </select>
        </td>
        <td>
          <input type="date" name="zahlungsdatum" value="{{ verkauf.zahlungsdatum | date:'Y-m-d' }}" onchange="confirmZahlungsdatumChange(this)">
        </td>
        <input type="hidden" name="verkauf_id" value="{{ verkauf.id }}">
        <td><input type="submit" value="Herunterladen"></td>
        <td><a href="{% url 'admin:inventory_verkauf_change' verkauf.id %}">bearbeiten</a></td>
        <td>
          <a href="#" class="delete-link">Löschen</a>
        </td>
      </form>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- JavaScript code to show the confirmation message -->
<script>
  const deleteLinks = document.querySelectorAll('.delete-link');
  deleteLinks.forEach(link => {
    link.addEventListener('click', (event) => {
      event.preventDefault();
      // Are you sure you want to delete this message? The selled object will be returned to your inventory.
      const confirmation = confirm("Sorry but you can not delete an invoice yet");
      if (confirmation) {
        // If user confirms, submit the form
        link.closest('form').submit();
      }
    });
  });
</script>

<!-- JavaScript code to show the warning message -->
<script>
let originalBezahltValue = '{{ verkauf.bezahlt }}';
  let originalZahlungsdatumValue = '{{ verkauf.zahlungsdatum | date:'Y-m-d' }}';

  function confirmBezahltChange(selectElement) {
    const newValue = selectElement.value;
    const confirmation = confirm(`Are you sure you want to change "Bezahlt" to "${newValue}"?`);
    if (confirmation) {
      originalBezahltValue = newValue; // Update the original value
    } else {
      selectElement.value = originalBezahltValue; // Reset the select element to the original value
    }
  }

  function confirmZahlungsdatumChange(inputElement) {
    const newValue = inputElement.value;
    const confirmation = confirm(`Are you sure you want to change "Zahlungsdatum" to "${newValue}"?`);
    if (confirmation) {
      originalZahlungsdatumValue = newValue; // Update the original value
    } else {
      inputElement.value = originalZahlungsdatumValue; // Reset the input element to the original value
    }
  }

</script>
{% endblock %}
